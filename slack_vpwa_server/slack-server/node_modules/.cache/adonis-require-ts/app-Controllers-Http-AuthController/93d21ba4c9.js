"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Channel_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Channel"));
const User_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/User"));
const RegisterUserValidator_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Validators/RegisterUserValidator"));
class AuthController {
    async register({ request }) {
        const data = await request.validate(RegisterUserValidator_1.default);
        const user = await User_1.default.create(data);
        const general = await Channel_1.default.findByOrFail('name', 'general');
        await user.related('channels').attach([general.id]);
        return user;
    }
    async login({ auth, request }) {
        const email = request.input('email');
        const password = request.input('password');
        return auth.use('api').attempt(email, password);
    }
    async logout({ auth }) {
        return auth.use('api').logout();
    }
    async me({ auth }) {
        await auth.user.load('channels');
        return auth.user;
    }
}
exports.default = AuthController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXV0aENvbnRyb2xsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJBdXRoQ29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLHVGQUF3QztBQUN4QyxpRkFBa0M7QUFDbEMsdUhBQXdFO0FBRXhFLE1BQXFCLGNBQWM7SUFDakMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxFQUFFLE9BQU8sRUFBdUI7UUFFN0MsTUFBTSxJQUFJLEdBQUcsTUFBTSxPQUFPLENBQUMsUUFBUSxDQUFDLCtCQUFxQixDQUFDLENBQUE7UUFDMUQsTUFBTSxJQUFJLEdBQUcsTUFBTSxjQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFBO1FBRXBDLE1BQU0sT0FBTyxHQUFHLE1BQU0saUJBQU8sQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLFNBQVMsQ0FBQyxDQUFBO1FBQzdELE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtRQUVuRCxPQUFPLElBQUksQ0FBQTtJQUNiLENBQUM7SUFFRCxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBdUI7UUFDaEQsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUNwQyxNQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFBO1FBRTFDLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFBO0lBQ2pELENBQUM7SUFFRCxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUUsSUFBSSxFQUF1QjtRQUN4QyxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUE7SUFDakMsQ0FBQztJQUVELEtBQUssQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQXVCO1FBQ3BDLE1BQU0sSUFBSSxDQUFDLElBQUssQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUE7UUFDakMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFBO0lBQ2xCLENBQUM7Q0FDRjtBQTNCRCxpQ0EyQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEh0dHBDb250ZXh0Q29udHJhY3QgfSBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0h0dHBDb250ZXh0J1xyXG5pbXBvcnQgQ2hhbm5lbCBmcm9tICdBcHAvTW9kZWxzL0NoYW5uZWwnXHJcbmltcG9ydCBVc2VyIGZyb20gJ0FwcC9Nb2RlbHMvVXNlcidcclxuaW1wb3J0IFJlZ2lzdGVyVXNlclZhbGlkYXRvciBmcm9tICdBcHAvVmFsaWRhdG9ycy9SZWdpc3RlclVzZXJWYWxpZGF0b3InXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBdXRoQ29udHJvbGxlciB7XHJcbiAgYXN5bmMgcmVnaXN0ZXIoeyByZXF1ZXN0IH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcclxuICAgIC8vIGlmIGludmFsaWQsIGV4Y2VwdGlvblxyXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcXVlc3QudmFsaWRhdGUoUmVnaXN0ZXJVc2VyVmFsaWRhdG9yKVxyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuY3JlYXRlKGRhdGEpXHJcbiAgICAvLyBqb2luIHVzZXIgdG8gZ2VuZXJhbCBjaGFubmVsXHJcbiAgICBjb25zdCBnZW5lcmFsID0gYXdhaXQgQ2hhbm5lbC5maW5kQnlPckZhaWwoJ25hbWUnLCAnZ2VuZXJhbCcpXHJcbiAgICBhd2FpdCB1c2VyLnJlbGF0ZWQoJ2NoYW5uZWxzJykuYXR0YWNoKFtnZW5lcmFsLmlkXSlcclxuXHJcbiAgICByZXR1cm4gdXNlclxyXG4gIH1cclxuXHJcbiAgYXN5bmMgbG9naW4oeyBhdXRoLCByZXF1ZXN0IH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcclxuICAgIGNvbnN0IGVtYWlsID0gcmVxdWVzdC5pbnB1dCgnZW1haWwnKVxyXG4gICAgY29uc3QgcGFzc3dvcmQgPSByZXF1ZXN0LmlucHV0KCdwYXNzd29yZCcpXHJcblxyXG4gICAgcmV0dXJuIGF1dGgudXNlKCdhcGknKS5hdHRlbXB0KGVtYWlsLCBwYXNzd29yZClcclxuICB9XHJcblxyXG4gIGFzeW5jIGxvZ291dCh7IGF1dGggfTogSHR0cENvbnRleHRDb250cmFjdCkge1xyXG4gICAgcmV0dXJuIGF1dGgudXNlKCdhcGknKS5sb2dvdXQoKVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgbWUoeyBhdXRoIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcclxuICAgIGF3YWl0IGF1dGgudXNlciEubG9hZCgnY2hhbm5lbHMnKVxyXG4gICAgcmV0dXJuIGF1dGgudXNlclxyXG4gIH1cclxufSJdfQ==