"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Channel_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Channel"));
class MessageRepository {
    async getAll(channelName) {
        const channel = await Channel_1.default.query()
            .where('name', channelName)
            .preload('messages', (messagesQuery) => messagesQuery.preload('author'))
            .firstOrFail();
        return channel.messages.map((message) => message.serialize());
    }
    async create(channelName, userId, content) {
        const channel = await Channel_1.default.findByOrFail('name', channelName);
        const message = await channel.related('messages').create({ createdBy: userId, content });
        await message.load('author');
        return message.serialize();
    }
}
exports.default = MessageRepository;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWVzc2FnZVJlcG9zaXRvcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJNZXNzYWdlUmVwb3NpdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLHVGQUF3QztBQUV4QyxNQUFxQixpQkFBaUI7SUFDN0IsS0FBSyxDQUFDLE1BQU0sQ0FBQyxXQUFtQjtRQUNyQyxNQUFNLE9BQU8sR0FBRyxNQUFNLGlCQUFPLENBQUMsS0FBSyxFQUFFO2FBQ2xDLEtBQUssQ0FBQyxNQUFNLEVBQUUsV0FBVyxDQUFDO2FBQzFCLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxhQUFhLEVBQUUsRUFBRSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7YUFDdkUsV0FBVyxFQUFFLENBQUE7UUFFaEIsT0FBTyxPQUFPLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBdUIsQ0FBQyxDQUFBO0lBQ3BGLENBQUM7SUFFTSxLQUFLLENBQUMsTUFBTSxDQUFDLFdBQW1CLEVBQUUsTUFBYyxFQUFFLE9BQWU7UUFDdEUsTUFBTSxPQUFPLEdBQUcsTUFBTSxpQkFBTyxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsV0FBVyxDQUFDLENBQUE7UUFDL0QsTUFBTSxPQUFPLEdBQUcsTUFBTSxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQTtRQUN4RixNQUFNLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7UUFFNUIsT0FBTyxPQUFPLENBQUMsU0FBUyxFQUF1QixDQUFBO0lBQ2pELENBQUM7Q0FDRjtBQWpCRCxvQ0FpQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IE1lc3NhZ2VSZXBvc2l0b3J5Q29udHJhY3QsIFNlcmlhbGl6ZWRNZXNzYWdlIH0gZnJvbSAnQGlvYzpSZXBvc2l0b3JpZXMvTWVzc2FnZVJlcG9zaXRvcnknXHJcbmltcG9ydCBDaGFubmVsIGZyb20gJ0FwcC9Nb2RlbHMvQ2hhbm5lbCdcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1lc3NhZ2VSZXBvc2l0b3J5IGltcGxlbWVudHMgTWVzc2FnZVJlcG9zaXRvcnlDb250cmFjdCB7XHJcbiAgcHVibGljIGFzeW5jIGdldEFsbChjaGFubmVsTmFtZTogc3RyaW5nKTogUHJvbWlzZTxTZXJpYWxpemVkTWVzc2FnZVtdPiB7XHJcbiAgICBjb25zdCBjaGFubmVsID0gYXdhaXQgQ2hhbm5lbC5xdWVyeSgpXHJcbiAgICAgIC53aGVyZSgnbmFtZScsIGNoYW5uZWxOYW1lKVxyXG4gICAgICAucHJlbG9hZCgnbWVzc2FnZXMnLCAobWVzc2FnZXNRdWVyeSkgPT4gbWVzc2FnZXNRdWVyeS5wcmVsb2FkKCdhdXRob3InKSlcclxuICAgICAgLmZpcnN0T3JGYWlsKClcclxuXHJcbiAgICByZXR1cm4gY2hhbm5lbC5tZXNzYWdlcy5tYXAoKG1lc3NhZ2UpID0+IG1lc3NhZ2Uuc2VyaWFsaXplKCkgYXMgU2VyaWFsaXplZE1lc3NhZ2UpXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYXN5bmMgY3JlYXRlKGNoYW5uZWxOYW1lOiBzdHJpbmcsIHVzZXJJZDogbnVtYmVyLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPFNlcmlhbGl6ZWRNZXNzYWdlPiB7XHJcbiAgICBjb25zdCBjaGFubmVsID0gYXdhaXQgQ2hhbm5lbC5maW5kQnlPckZhaWwoJ25hbWUnLCBjaGFubmVsTmFtZSlcclxuICAgIGNvbnN0IG1lc3NhZ2UgPSBhd2FpdCBjaGFubmVsLnJlbGF0ZWQoJ21lc3NhZ2VzJykuY3JlYXRlKHsgY3JlYXRlZEJ5OiB1c2VySWQsIGNvbnRlbnQgfSlcclxuICAgIGF3YWl0IG1lc3NhZ2UubG9hZCgnYXV0aG9yJylcclxuXHJcbiAgICByZXR1cm4gbWVzc2FnZS5zZXJpYWxpemUoKSBhcyBTZXJpYWxpemVkTWVzc2FnZVxyXG4gIH1cclxufSJdfQ==